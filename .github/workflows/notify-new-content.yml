name: Notify on New Content

on:
  push:
    branches: [main]

jobs:
  notify:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Debug info
        run: |
          echo "Changed files:"
          git diff --name-only HEAD^ HEAD || echo "No previous commit"
          echo ""
          echo "Commit message:"
          git log -1 --pretty=format:'%s'
          echo ""
          echo "Author:"
          git log -1 --pretty=format:'%an'

      - name: Check if content changed
        id: check
        run: |
          CHANGED=$(git diff --name-only HEAD^ HEAD | grep -c "^content/" || echo "0")
          echo "content_changed=$CHANGED" >> $GITHUB_OUTPUT
          echo "Files changed in content/: $CHANGED"

      - name: Send notification email
        if: steps.check.outputs.content_changed != '0'
        uses: dawidd6/action-send-mail@v3
        with:
          server_address: smtp.gmail.com
          server_port: 587
          username: ${{ secrets.EMAIL_USERNAME }}
          password: ${{ secrets.EMAIL_PASSWORD }}
          subject: 'KWS Linkhout - Nieuwe content toegevoegd'
          to: jochen_thoelen@telenet.be, Joel.bynens@gmail.com
          from: KWS Linkhout CMS <${{ secrets.EMAIL_USERNAME }}>
          html_body: |
            <h2>Nieuwe content wacht op goedkeuring</h2>
            <p>Er is nieuwe content toegevoegd aan de KWS Linkhout website via Decap CMS.</p>
            <p style="margin: 20px 0;">
              <a href="https://kwslinkhout.be/admin" 
                 style="padding: 12px 24px; background: #24292e; color: white; text-decoration: none; border-radius: 5px; display: inline-block;">
                Ga naar CMS om te reviewen
              </a>
            </p>
            <hr>
            <p style="color: #666; font-size: 12px;">Dit is een automatische melding van KWS Linkhout CMS.</p>
