name: Notify on New Content

on:
  push:
    branches: [main]
    paths:
      - 'content/**'

jobs:
  notify:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Get commit info
        id: commit
        run: |
          echo "message=$(git log -1 --pretty=format:'%s')" >> $GITHUB_OUTPUT
          echo "author=$(git log -1 --pretty=format:'%an')" >> $GITHUB_OUTPUT

      - name: Send notification email
        uses: dawidd6/action-send-mail@v3
        with:
          server_address: smtp.gmail.com
          server_port: 587
          username: ${{ secrets.EMAIL_USERNAME }}
          password: ${{ secrets.EMAIL_PASSWORD }}
          subject: 'KWS Linkhout - Nieuwe content toegevoegd'
          to: jochen_thoelen@telenet.be, Joel.bynens@gmail.com
          from: KWS Linkhout CMS <${{ secrets.EMAIL_USERNAME }}>
          html_body: |
            <h2>Nieuwe content wacht op goedkeuring</h2>
            <p><strong>Auteur:</strong> ${{ steps.commit.outputs.author }}</p>
            <p><strong>Wijziging:</strong> ${{ steps.commit.outputs.message }}</p>
            <p>Er is nieuwe content toegevoegd aan de KWS Linkhout website.</p>
            <p style="margin: 20px 0;">
              <a href="https://kwslinkhout.be/admin" 
                 style="padding: 12px 24px; background: #24292e; color: white; text-decoration: none; border-radius: 5px; display: inline-block;">
                Ga naar CMS om te reviewen
              </a>
            </p>
            <hr>
            <p style="color: #666; font-size: 12px;">
              Dit is een automatische melding van KWS Linkhout CMS.<br>
              Tijd: ${{ github.event.head_commit.timestamp }}
            </p>
