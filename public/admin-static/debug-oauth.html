<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>OAuth Debug</title>
  <style>
    body { font-family: sans-serif; padding: 20px; }
    pre { background: #f5f5f5; padding: 10px; overflow-x: auto; }
    button { padding: 10px 20px; margin: 5px; }
  </style>
</head>
<body>
  <h1>OAuth Debug</h1>
  
  <h2>Current URL:</h2>
  <pre id="url"></pre>
  
  <h2>URL Parameters:</h2>
  <pre id="params"></pre>
  
  <h2>Tests:</h2>
  <button onclick="testDirect()">Test Direct GitHub OAuth</button>
  <button onclick="testPopup()">Test Popup Flow</button>
  
  <h2>Results:</h2>
  <pre id="results"></pre>
  
  <script>
    // Show current URL info
    document.getElementById('url').textContent = window.location.href;
    
    const params = new URLSearchParams(window.location.search);
    let paramsText = '';
    for (const [key, value] of params) {
      paramsText += key + ': ' + value + '\n';
    }
    document.getElementById('params').textContent = paramsText || 'No parameters';
    
    function log(msg) {
      document.getElementById('results').textContent += msg + '\n';
    }
    
    function testDirect() {
      const clientId = prompt('Enter your GitHub Client ID:');
      if (!clientId) return;
      
      const redirectUri = 'https://kwslinkhout.be/admin-static/auth.html';
      const url = `https://github.com/login/oauth/authorize?client_id=${clientId}&redirect_uri=${encodeURIComponent(redirectUri)}&scope=repo`;
      
      log('Redirecting to: ' + url);
      window.location.href = url;
    }
    
    function testPopup() {
      const clientId = prompt('Enter your GitHub Client ID:');
      if (!clientId) return;
      
      const redirectUri = 'https://kwslinkhout.be/admin-static/auth.html';
      const url = `https://github.com/login/oauth/authorize?client_id=${clientId}&redirect_uri=${encodeURIComponent(redirectUri)}&scope=repo`;
      
      log('Opening popup: ' + url);
      const popup = window.open(url, 'github-oauth', 'width=500,height=600');
      
      // Listen for messages from popup
      window.addEventListener('message', function(e) {
        log('Received message: ' + e.data);
      });
    }
    
    // If we have a code, show it
    if (params.get('code')) {
      log('SUCCESS! Code received: ' + params.get('code').substring(0, 10) + '...');
    }
  </script>
</body>
</html>
